<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Biblioteca Dr. René Favaloro</title>

    <meta name="description"
        content="App de gestión y consulta para la Biblioteca del Centro Educativo N° 28 Dr. René Favaloro">
    <meta name="theme-color" content="#020617">

    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/styles.css">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@500;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- FIREBASE SDKs (Global Namespace) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
</head>

<body>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div
            style="width:50px; height:50px; border:3px solid #333; border-top-color:cyan; border-radius:50%; animation:spin 1s linear infinite;">
        </div>
        <p style="margin-top:20px; animation:pulse 2s infinite;">Cargando Sistema...</p>
    </div>

    <!-- App Container -->
    <div id="app" class="container hidden">
        <header id="main-header"></header>
        <main id="main-content"></main>
    </div>

    <!-- Bottom Navigation -->
    <nav id="bottom-nav" class="hidden"></nav>

    <!-- Footer Legal -->
    <div id="legal-footer"
        style="text-align:center; padding: 2rem 1rem; opacity:0.95; font-size:0.75rem; color:white; margin-top:2rem;">
        <p>© 2025 BIBLIOTECA DR. RENÉ FAVALORO</p>
        <p>Potenciado por <b>Antigravity AI</b></p>
    </div>

    <!-- Main Logic -->
    <script>
        // CLEANUP: Force remove old Service Workers to fix cache issues
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                for (let registration of registrations) {
                    // Si el SW es el viejo 'sw.js', lo desregistramos
                    if (registration.active && registration.active.scriptURL.includes('sw.js')) {
                        console.log('Old SW found. Unregistering:', registration);
                        registration.unregister();
                        window.location.reload(); // Recargar para aplicar cambios
                    }
                }
            });
        }
    </script>
    <script type="module" src="js/app.js"></script>
</body>

</html>